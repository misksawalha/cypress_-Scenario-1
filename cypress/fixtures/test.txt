
import { login, logout, requestLeave, approveReject } from '../../support/helpers/orangeHRM/leaveRequestHelper';
import { checkDataInTable } from '../../support/utils/orangeHRMUtils/checkDataInTable'
//https://opensource-demo.orangehrmlive.com/web/index.php/api/v2/time/timesheets/269/entries

const min = 200;
const max = 500;
const randomValue = min + Math.floor(Math.random() * (max - min + 1));
let empNumberResponse: number
let username = `misksawallha${randomValue}`;
let password = "misk123";

describe('Time sheet', () => {
  beforeEach(() => {
    cy.fixture('addEmployee').as('data')
    cy.fixture('leaveData').as('leaveData')
    cy.visit("https://opensource-demo.orangehrmlive.com/web/index.php/auth/login");
    login("Admin", "admin123");
    // add employee 
    cy.get('@data').then((infoData: any) => {
      cy.request({
        method: 'POST',
        url: 'https://opensource-demo.orangehrmlive.com/web/index.php/api/v2/pim/employees',
        body: {
          firstName:  infoData.addEmployee.firstName,
          middleName: infoData.addEmployee.middleName,
          lastName:   infoData.addEmployee.lastName,
          empPicture: infoData.addEmployee.empPicture,
          employeeId: infoData.addEmployee.employeeId
        }
      }).then((response) => {
        //the id for the emp
        empNumberResponse = response.body.data.empNumber
      }).then(() => {
        cy.request({
          method: 'POST',
          url: 'https://opensource-demo.orangehrmlive.com/web/index.php/api/v2/admin/users',
          body: {
            username: username,
            password: password,
            status: true,
            userRoleId: 2,
            empNumber: empNumberResponse
          }
        }).then((response) => {
          expect(response).property('status').to.eq(200);
        });
      })
      });
    })
  });


  it("logout and then login", () => {
   logout();
    // login(username, password);
    // cy.request({
    //     method: 'PUT',
    //     url: `https://opensource-demo.orangehrmlive.com/web/index.php/api/v2/time/timesheets/${empNumberResponse}/entries`,
    //     body: {
    //         entries:[
    //             {
    //                 projectId:2,
    //                 activityId:11,
    //                 dates:{
    //                     "2023-10-23":{"duration":"09:00"}
    //                 }
    //             }
    //         ],
    //         deletedEntries:[]
    //     }
    //   }).then(()=>{
    //     cy.request({
    //         method: 'PUT',
    //         url: `https://opensource-demo.orangehrmlive.com/web/index.php/api/v2/time/timesheets/${empNumberResponse}`,
    //         body: {
    //             action:"SUBMIT"
    //         }
    //       }).then((response)=>{
    //          console.log(response)
    //       })
        
    //   })
  })
